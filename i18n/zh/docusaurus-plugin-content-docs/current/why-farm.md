---
sidebar_position: 2
---

# 为什么需要 Farm？

随着 web 项目规模的扩大，构建性能已经成为主要瓶颈，对于一个庞大的项目，使用 webpack 编译可能需要 10min 甚至更多，一次 hmr 更新可能需要 10s 甚至更多，严重降低了研发效率。

然后出现了像 vite 这样的工具，它使用原生 ESM，并在 dev 模式下不对源文件进行打包，同时使用 esbuild 预打包依赖项，这使得 dev 服务器启动和 HMR 非常快。

但 vite 等工具使用的 Unbundled 并不完美，对于大型项目来说仍然存在很大的问题：
* **大量的模块请求**：对于一个大型项目，可能需要加载数千个模块，使用原生模块系统加载数千个模块会导致浏览器卡住甚至崩溃。
* **开发和生产之间的不一致**：出于兼容性和请求数量、请求层级的考虑，原生 ES 模块在大多数情况下无法在生产中使用。 因此非捆绑工具选择在生产中捆绑。 这就带来了不一致，当这种不一致导致生产错误时，调试起来非常困难且非常痛苦。 而 vite 在 dev 中使用 esbuild，在生产中使用 rollup，这更加就放大了不一致性。
* 而Vite在dev上之所以这么快，是因为有 esbuild，它是用 go 编写的。 Go 利用了原生平台的优势并且比 Js 快得多。

我们需要的是一个快速、强大、一致的 Web 构建工具，可以在解决上述问题的基础上，保证编译效率。

不过 Farm 不仅仅是一个用 Rust 重写的普通捆绑器，它还有很多强大且先进的设计：

## Farm 设计理念

* **性能优先**：一切都会用 Rust 编写，只有少数不是性能瓶颈的部分会用 JS 编写
* **一致性有限**：默认情况下确保开发和生产完全相同，您在开发中看到的将与您在生产中得到的相同。
* **局部打包**：Farm的打包目标不是将所有东西打包在一起，而是限制资源的请求数量。 Farm会根据依赖关系和资源大小将您的项目捆绑成20-30个小资源，在不损失缓存粒度的情况下获得最佳的资源加载性能。
* **所有资源视为一等公民**：Farm 不再需要将所有内容转换为 Javascript，它将任何内容视为一流公民，如“html”、“js/jsx/ts/tsx”等资产 、`css/scss`、`png/svg/...`都是Farm支持的基础模块，更多资源可以通过插件支持。
* **兼容性**：Farm 将适用于旧版 (ES5) 和现代浏览器。
* **Rollup 风格的插件系统**：轻松创建自己的插件，并轻松从 rollup/vite/webpack 迁移您的插件/项目。


Farm 的目标是成为真正的下一代构建工具，快速、强大、一致，并为 Web 开发人员提供最佳的开发体验。